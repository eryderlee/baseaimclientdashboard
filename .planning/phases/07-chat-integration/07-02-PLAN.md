---
phase: 07-chat-integration
plan: 02
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - components/client/chat-buttons.tsx
  - app/dashboard/chat/page.tsx
  - components/dashboard/dashboard-overview.tsx
  - components/dashboard/dashboard-nav.tsx
  - app/dashboard/page.tsx
autonomous: true

must_haves:
  truths:
    - "Client sees WhatsApp button in dashboard that opens WhatsApp with pre-filled message including their name and company"
    - "Client sees Telegram button in dashboard that opens Telegram chat"
    - "Chat buttons only appear when admin has configured the respective contact details"
    - "Chat page shows contact buttons instead of the old mock chat interface"
    - "Dashboard nav Chat link and Open Chat button link to updated chat page"
    - "Pre-filled WhatsApp message includes client name and company name"
  artifacts:
    - path: "components/client/chat-buttons.tsx"
      provides: "Reusable chat buttons component with WhatsApp and Telegram links"
      exports: ["ChatButtons"]
    - path: "app/dashboard/chat/page.tsx"
      provides: "Updated chat page with contact buttons instead of mock chat"
    - path: "components/dashboard/dashboard-overview.tsx"
      provides: "Dashboard with chat buttons integrated into hero section"
    - path: "components/dashboard/dashboard-nav.tsx"
      provides: "Nav with updated chat link behavior"
  key_links:
    - from: "components/client/chat-buttons.tsx"
      to: "lib/utils/chat-links.ts"
      via: "import generateWhatsAppLink, createClientMessage"
      pattern: "generateWhatsAppLink|createClientMessage"
    - from: "app/dashboard/chat/page.tsx"
      to: "lib/dal.ts"
      via: "getChatSettings() fetch in server component"
      pattern: "getChatSettings"
    - from: "app/dashboard/page.tsx"
      to: "lib/dal.ts"
      via: "getChatSettings() and session data for chat buttons"
      pattern: "getChatSettings"
---

<objective>
Create client-facing chat buttons component and integrate it into the dashboard, replacing the existing mock chat interface with WhatsApp/Telegram click-to-chat buttons.

Purpose: Clients need a simple way to contact BaseAim directly from the dashboard. WhatsApp and Telegram links with pre-filled context (client name, company) provide instant contact without building a real-time chat system.
Output: ChatButtons component showing WhatsApp/Telegram links, integrated into both the chat page and dashboard overview. Replaces the old mock chat interface.
</objective>

<execution_context>
@C:\Users\eryde\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\eryde\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-chat-integration/07-RESEARCH.md
@.planning/phases/07-chat-integration/07-01-SUMMARY.md

Key files to reference:
- @components/dashboard/dashboard-overview.tsx (hero section has "Message Project Manager" button at line ~318-328 that needs updating)
- @components/dashboard/dashboard-nav.tsx (nav has Chat link and "Open Chat" button)
- @app/dashboard/chat/page.tsx (current mock chat page to replace)
- @app/dashboard/page.tsx (server component that fetches milestones, needs to also fetch chat settings + client info)
- @app/dashboard/layout.tsx (layout passes session user data)
- @lib/dal.ts (getChatSettings function from Plan 01)
- @lib/utils/chat-links.ts (URL generation utilities from Plan 01)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ChatButtons component and update chat page</name>
  <files>
    components/client/chat-buttons.tsx
    app/dashboard/chat/page.tsx
  </files>
  <action>
    1. Create components/client/chat-buttons.tsx:
       - 'use client' directive
       - Import MessageCircle and Send from lucide-react (MessageCircle for WhatsApp, Send for Telegram)
       - Import Button from @/components/ui/button
       - Import { generateWhatsAppLink, generateTelegramLink, createClientMessage } from @/lib/utils/chat-links
       - Props interface ChatButtonsProps:
         - whatsappNumber?: string | null
         - telegramUsername?: string | null
         - clientName: string
         - companyName: string
         - layout?: 'row' | 'column' (default 'row')
       - Component renders:
         - Container div with flex layout (gap-4, direction based on layout prop)
         - WhatsApp button (only if whatsappNumber is truthy):
           - Green gradient styling matching the dashboard aesthetic: "bg-gradient-to-r from-green-600 to-emerald-500 hover:from-green-700 hover:to-emerald-600 text-white shadow-lg"
           - Renders as <a> tag via Button asChild pattern
           - href = generateWhatsAppLink(whatsappNumber, createClientMessage(clientName, companyName))
           - target="_blank" rel="noopener noreferrer"
           - aria-label="Chat on WhatsApp (opens in new tab)"
           - Icon: MessageCircle (h-5 w-5)
           - Text: "Chat on WhatsApp"
         - Telegram button (only if telegramUsername is truthy):
           - Blue gradient styling: "bg-gradient-to-r from-blue-600 to-sky-500 hover:from-blue-700 hover:to-sky-600 text-white shadow-lg"
           - Same Button asChild + <a> pattern
           - href = generateTelegramLink(telegramUsername)
           - target="_blank" rel="noopener noreferrer"
           - aria-label="Chat on Telegram (opens in new tab)"
           - Icon: Send (h-5 w-5)
           - Text: "Chat on Telegram"
         - If neither whatsappNumber nor telegramUsername is configured, render nothing (return null)

    2. Replace app/dashboard/chat/page.tsx entirely:
       - Remove the old ChatInterface and NotificationCenter imports
       - Make it an async server component
       - Import getChatSettings from @/lib/dal, auth from @/lib/auth, prisma from @/lib/prisma
       - Import ChatButtons from @/components/client/chat-buttons
       - Import Card, CardContent, CardHeader, CardTitle, CardDescription from @/components/ui/card
       - Import MessageCircle from lucide-react
       - Fetch: session via auth(), settings via getChatSettings()
       - Fetch client profile: prisma.client.findUnique({ where: { userId: session.user.id }, select: { companyName: true } })
       - Get clientName from session.user.name and companyName from client profile
       - Render a clean page:
         - Header: "Contact Us" title, "Get in touch with your BaseAim team" description
         - Card with ChatButtons component, passing settings and client info
         - Below buttons: informational text "Click a button above to open a conversation. Your name and company will be included automatically so we know who you are."
         - If no settings configured: show a friendly message "Contact details are being set up. Please check back soon." with MessageCircle icon
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - Navigate to /dashboard/chat as a client user
    - If admin has configured settings (from Plan 01): WhatsApp and Telegram buttons appear
    - Clicking WhatsApp button opens wa.me link with pre-filled message containing client name and company
    - Clicking Telegram button opens t.me link
    - If no settings configured: friendly "being set up" message appears
  </verify>
  <done>
    ChatButtons component renders WhatsApp/Telegram links with correct URLs. Chat page shows contact buttons instead of old mock chat interface. Buttons only appear when admin has configured respective contact details.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate chat buttons into dashboard overview and update nav</name>
  <files>
    app/dashboard/page.tsx
    components/dashboard/dashboard-overview.tsx
    components/dashboard/dashboard-nav.tsx
  </files>
  <action>
    1. Update app/dashboard/page.tsx:
       - Add imports: getChatSettings from @/lib/dal, auth from @/lib/auth, prisma from @/lib/prisma
       - Fetch chat settings: const chatSettings = await getChatSettings()
       - Fetch session: const session = await auth()
       - Fetch client profile for company name: const client = await prisma.client.findUnique({ where: { userId: session!.user!.id }, select: { companyName: true } })
       - Pass to DashboardOverview: chatSettings={{ whatsappNumber: chatSettings?.whatsappNumber, telegramUsername: chatSettings?.telegramUsername }}, clientName={session?.user?.name || 'Client'}, companyName={client?.companyName || 'Company'}

    2. Update components/dashboard/dashboard-overview.tsx:
       - Add to DashboardOverviewProps interface:
         - chatSettings?: { whatsappNumber?: string | null; telegramUsername?: string | null }
         - clientName?: string
         - companyName?: string
       - Import ChatButtons from @/components/client/chat-buttons
       - In the hero section buttons area (around line 309-329), replace the existing "Message Project Manager" ghost button with:
         - ChatButtons component with whatsappNumber={chatSettings?.whatsappNumber}, telegramUsername={chatSettings?.telegramUsername}, clientName={clientName || 'Client'}, companyName={companyName || 'Company'}
         - Keep the "Upload or Approve Files" button as-is
         - If no chat settings configured, keep the existing "Message Project Manager" link to /dashboard/chat as fallback
       - In the statCards array, update the "Unread Messages" card:
         - Change title to "Contact Team"
         - Change description to "Chat via WhatsApp or Telegram"
         - Change action text to "Contact us"
         - Keep href as /dashboard/chat

    3. Update components/dashboard/dashboard-nav.tsx:
       - The nav already has a Chat link at /dashboard/chat and an "Open Chat" button - these can stay as-is since /dashboard/chat now shows the contact buttons page
       - No changes needed to nav links (they already point to /dashboard/chat which now has the new content)
       - Actually, do remove the "Open Chat" gradient button at the bottom of the nav (line 152-157) since chat is now just links, not a full chat app. The nav already has a Chat nav item in the pill navigation.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - Navigate to /dashboard as client user
    - Hero section shows WhatsApp/Telegram buttons (if admin configured settings) instead of "Message Project Manager"
    - "Contact Team" stat card links to /dashboard/chat
    - Nav no longer shows separate "Open Chat" gradient button
    - Dashboard chat page (/dashboard/chat) shows contact buttons
  </verify>
  <done>
    Dashboard overview hero section displays WhatsApp/Telegram chat buttons with client context. Stat card updated to "Contact Team". Nav cleaned up. Full integration of chat buttons across client-facing pages.
  </done>
</task>

</tasks>

<verification>
1. As admin: Configure WhatsApp number and Telegram username at /admin/settings
2. As client: Navigate to /dashboard - see WhatsApp and Telegram buttons in hero section
3. As client: Click WhatsApp button - opens wa.me link with pre-filled message "Hello! I'm [name] from [company]. I'd like to discuss my project."
4. As client: Click Telegram button - opens t.me/username link
5. As client: Navigate to /dashboard/chat - see contact buttons page (not old mock chat)
6. As client: If admin has NOT configured settings - buttons don't appear, fallback message shown
7. TypeScript compiles: `npx tsc --noEmit`
</verification>

<success_criteria>
- Client sees WhatsApp click-to-chat button that opens WhatsApp with pre-filled message including client context
- Client sees Telegram click-to-chat button that opens Telegram
- Chat buttons only render when admin has configured respective contact details
- Pre-filled messages include client name and company name
- Old mock chat interface is replaced with clean contact page
- Dashboard overview integrates chat buttons seamlessly
</success_criteria>

<output>
After completion, create `.planning/phases/07-chat-integration/07-02-SUMMARY.md`
</output>
