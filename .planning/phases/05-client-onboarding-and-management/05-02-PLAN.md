---
phase: 05-client-onboarding-and-management
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - components/admin/client-form.tsx
  - app/admin/clients/new/page.tsx
  - app/admin/page.tsx
autonomous: true

must_haves:
  truths:
    - "Admin can navigate to client creation page from admin dashboard"
    - "Admin sees a form with fields for contact name, email, password, company name, and optional fields"
    - "Form validates inputs on blur with clear error messages"
    - "Admin can auto-generate a secure password with one click"
    - "Submitting valid form creates client and redirects to admin dashboard"
    - "Toast notification confirms successful creation or shows error"
  artifacts:
    - path: "components/admin/client-form.tsx"
      provides: "Reusable client form with React Hook Form + Zod validation"
      exports: ["ClientForm"]
    - path: "app/admin/clients/new/page.tsx"
      provides: "New client creation page at /admin/clients/new"
      contains: "ClientForm"
    - path: "app/admin/page.tsx"
      provides: "Admin dashboard with Add Client button"
      contains: "Add Client"
  key_links:
    - from: "components/admin/client-form.tsx"
      to: "lib/schemas/client.ts"
      via: "zodResolver(createClientSchema)"
      pattern: "zodResolver.*createClientSchema"
    - from: "components/admin/client-form.tsx"
      to: "app/admin/actions.ts"
      via: "calls createClient or updateClient Server Action"
      pattern: "(createClient|updateClient)"
    - from: "app/admin/page.tsx"
      to: "app/admin/clients/new/page.tsx"
      via: "Link to /admin/clients/new"
      pattern: "/admin/clients/new"
---

<objective>
Build the client creation UI: a reusable ClientForm component with React Hook Form + Zod validation, the /admin/clients/new page, and an "Add Client" button on the admin dashboard.

Purpose: Enables admin to onboard new clients through a validated form that atomically creates user account, client profile, and standard milestones.
Output: Working client creation flow from admin dashboard to form submission with toast feedback.
</objective>

<execution_context>
@C:\Users\eryde\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\eryde\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-client-onboarding-and-management/05-RESEARCH.md
@.planning/phases/05-client-onboarding-and-management/05-01-SUMMARY.md
@lib/schemas/client.ts
@app/admin/actions.ts
@lib/utils/password.ts
@app/admin/page.tsx
@components/ui/input.tsx
@components/ui/label.tsx
@components/ui/button.tsx
@components/ui/card.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build reusable ClientForm component</name>
  <files>components/admin/client-form.tsx</files>
  <action>
    Create `components/admin/client-form.tsx` as a `'use client'` component.

    **Props interface:**
    ```typescript
    interface ClientFormProps {
      mode: 'create' | 'edit'
      defaultValues?: Partial<CreateClientInput>
      clientId?: string  // required for edit mode
    }
    ```

    **Implementation:**
    1. Use `useForm<CreateClientInput>` with `zodResolver(createClientSchema)` for create mode
    2. Use `useForm<UpdateClientInput>` with `zodResolver(updateClientSchema)` for edit mode
    3. Set `mode: 'onBlur'` for validation timing (validate when field loses focus)
    4. If `defaultValues` provided, pass to useForm

    **Form layout** using shadcn Card, Input, Label, Button, Textarea:
    - Section 1: "Contact Information"
      - Name (required) - full width
      - Email (required, only in create mode) - full width
      - Password (required, only in create mode) - with "Generate" button beside it
        - Generate button calls `generateSecurePassword()` from `@/lib/utils/password` and sets the field value via `setValue('password', generated)`
    - Section 2: "Company Details"
      - Company Name (required) - full width
      - Industry (optional) - half width
      - Website (optional) - half width
      - Phone (optional) - half width
      - Address (optional) - full width, use Textarea

    **Error display:** Below each field, show `{errors.fieldName?.message}` in `text-sm text-destructive mt-1` with aria-invalid on the input.

    **Submit handler:**
    - Create mode: Build FormData from validated data, call `createClient(formData)` Server Action
    - Edit mode: Build FormData, call `updateClient(clientId!, formData)` Server Action
    - On error result: `toast.error(result.error)`
    - On success in edit mode: `toast.success('Client updated successfully')`
    - Create mode redirects server-side, so no client-side success handling needed
    - Use `isSubmitting` from formState to disable button and show "Creating..." / "Saving..." text

    **Styling:** Match existing admin UI patterns (neutral-50 background, consistent spacing). Use `space-y-6` for form sections, `grid grid-cols-2 gap-4` for side-by-side fields on desktop.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - Component renders without errors (verified during page creation in Task 2)
  </verify>
  <done>
    - ClientForm renders with all fields, validation on blur, password generation
    - Works in both create and edit modes based on props
    - Calls appropriate Server Action and shows toast feedback
  </done>
</task>

<task type="auto">
  <name>Task 2: Create new client page and add navigation button to admin dashboard</name>
  <files>
    app/admin/clients/new/page.tsx
    app/admin/page.tsx
  </files>
  <action>
    1. Create `app/admin/clients/new/page.tsx`:
       - Server component (async function)
       - Verify admin role via `verifySession()`, redirect to `/dashboard` if not admin
       - Layout: Back button linking to `/admin` (use ArrowLeft icon + "Back to Admin" like existing pattern in `[clientId]/page.tsx`)
       - Heading: "Add New Client"
       - Subtext: "Create a new client account with company details and login credentials"
       - Render `<ClientForm mode="create" />`

    2. Update `app/admin/page.tsx`:
       - Add an "Add Client" button in the header area, next to the title/description
       - Use: `<Button asChild><Link href="/admin/clients/new"><UserPlus className="h-4 w-4 mr-2" /> Add Client</Link></Button>`
       - Import `UserPlus` from lucide-react and `Link` from next/link (Link already imported)
       - Position the button to the right of the title using `flex items-center justify-between` on the header div
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - `npm run build` completes without errors
  </verify>
  <done>
    - /admin/clients/new page renders the ClientForm in create mode
    - Admin dashboard has visible "Add Client" button that links to /admin/clients/new
    - Back navigation from new client page returns to admin dashboard
  </done>
</task>

</tasks>

<verification>
- `npm run build` succeeds
- Navigating to /admin shows "Add Client" button
- Clicking "Add Client" navigates to /admin/clients/new
- Form displays all fields with proper labels
- Submitting empty form shows validation errors on blur
- Generate password button fills password field
</verification>

<success_criteria>
- Admin can navigate from dashboard to client creation form
- Form validates all required fields with clear error messages
- Password can be auto-generated
- Form submission calls createClient Server Action
- Successful creation redirects to admin dashboard
</success_criteria>

<output>
After completion, create `.planning/phases/05-client-onboarding-and-management/05-02-SUMMARY.md`
</output>
