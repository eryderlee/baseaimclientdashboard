---
phase: 02-core-progress-tracking
plan: 03
type: execute
wave: 3
depends_on: ["02-02"]
files_modified:
  - app/dashboard/progress/page.tsx
  - app/dashboard/page.tsx
autonomous: false

must_haves:
  truths:
    - "Progress page fetches milestone data from database (not mock data)"
    - "Dashboard overview shows overall progress percentage from real milestone data"
    - "User sees linear milestone checklist with all standard project steps"
    - "Currently active milestone is visually highlighted"
    - "Milestones display status, description, due date, and progress notes"
  artifacts:
    - path: "app/dashboard/progress/page.tsx"
      provides: "Progress page with real data fetching and MilestoneChecklist component"
      contains: "prisma.milestone.findMany"
    - path: "app/dashboard/page.tsx"
      provides: "Dashboard overview with milestone progress summary"
      contains: "calculateOverallProgress"
  key_links:
    - from: "app/dashboard/progress/page.tsx"
      to: "components/dashboard/milestone-checklist.tsx"
      via: "imports and renders MilestoneChecklist"
      pattern: "import.*MilestoneChecklist.*from.*components/dashboard/milestone-checklist"
    - from: "app/dashboard/progress/page.tsx"
      to: "prisma"
      via: "fetches milestones from database"
      pattern: "prisma\\.milestone\\.findMany"
---

<objective>
Refactor progress page to use real data and integrate milestone components

Purpose: Wire up the UI components to real data sources, replacing mock data with database queries. This completes the core progress tracking feature (PROG-01, PROG-03).

Output: Progress page fetching from database, dashboard showing real progress percentage.
</objective>

<execution_context>
@C:\Users\eryde\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\eryde\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-progress-tracking/02-RESEARCH.md
@.planning/phases/02-core-progress-tracking/02-01-SUMMARY.md
@.planning/phases/02-core-progress-tracking/02-02-SUMMARY.md
@app/dashboard/progress/page.tsx
@app/dashboard/page.tsx
@components/dashboard/milestone-checklist.tsx
@lib/milestone-utils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor progress page to fetch real data</name>
  <files>app/dashboard/progress/page.tsx</files>
  <action>
Refactor `app/dashboard/progress/page.tsx` to:

1. Convert to async Server Component (remove "use client" if present)
2. Import prisma from lib/prisma
3. Import auth from lib/auth (or next-auth) for session
4. Import redirect from next/navigation
5. Import MilestoneChecklist from components/dashboard/milestone-checklist
6. Import Milestone type from lib/types/milestone

Data fetching:
- Get session using auth()
- If no session, redirect to /login
- Fetch milestones from database:
```typescript
const milestones = await prisma.milestone.findMany({
  where: {
    client: {
      userId: session.user.id
    }
  },
  orderBy: {
    order: 'asc'
  }
})
```

Page structure:
- Header section: h1 "Progress Tracking", p "Monitor your project milestones and track progress"
- MilestoneChecklist component receiving milestones data

For now, since there may not be a logged-in client with milestones, add a fallback:
- If milestones array is empty, MilestoneChecklist will show empty state (handled in component)
- During development/testing, the page should still render without crashing

Remove all mockMilestones data and related calculations - the MilestoneChecklist component handles this internally now.

Keep the existing page layout/styling structure but simplify the content to just the header and MilestoneChecklist.
  </action>
  <verify>
Run `npm run build` to verify the page compiles. Check that no mock data remains in the file.
  </verify>
  <done>Progress page fetches milestone data from database via Prisma and renders MilestoneChecklist component</done>
</task>

<task type="auto">
  <name>Task 2: Update dashboard overview to use milestone utilities</name>
  <files>app/dashboard/page.tsx</files>
  <action>
Update `app/dashboard/page.tsx` to use the milestone utility functions:

1. Import calculateOverallProgress from lib/milestone-utils
2. Import Milestone type from lib/types/milestone

Replace the hardcoded progress calculation with:
```typescript
const overallProgress = calculateOverallProgress(milestones)
const completedMilestones = milestones.filter(m => m.status === 'COMPLETED').length
```

The dashboard page uses mock data which is fine for now (Phase 3 will add client data isolation). The key change is using the shared utility function for progress calculation to ensure consistency.

Keep the existing mock data structure but ensure:
- overallProgress uses calculateOverallProgress() instead of manual calculation
- The "Client Acquisition System" stat card shows the calculated percentage
- The milestone section displays milestones with proper status handling

Note: The dashboard page can remain a client component ("use client") since it has state for chart expansion. The milestone utility functions are pure and work in both client and server components.
  </action>
  <verify>
Run `npm run build` to verify the page compiles. Check that calculateOverallProgress is imported and used.
  </verify>
  <done>Dashboard overview uses calculateOverallProgress utility for consistent progress calculation</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete milestone checklist system with:
- Database schema with notes field
- TypeScript types for milestones
- Standard milestone template (6 milestones)
- UI components: MilestoneStatusBadge, MilestoneItem, MilestoneNotes, MilestoneChecklist
- Progress page with real data fetching
- Dashboard with shared progress calculation
  </what-built>
  <how-to-verify>
1. Start the dev server: `npm run dev`
2. Navigate to http://localhost:3000/dashboard/progress
3. Verify:
   - Page loads without errors (may show empty state if no milestones in DB)
   - Overall progress card displays with progress bar
   - Milestones timeline section renders
4. Navigate to http://localhost:3000/dashboard
5. Verify:
   - Dashboard loads without errors
   - Milestone section shows progress correctly
   - "Client Acquisition System" stat card shows progress percentage

Note: With no client data in database, the progress page may show empty state. This is expected - Phase 3 adds client data isolation and seeding.

Check accessibility:
- Status icons should have visible text labels (not color-only)
- Active milestone (if any) should be visually distinct

Check for TypeScript errors in terminal - there should be none.
  </how-to-verify>
  <resume-signal>Type "approved" if the milestone checklist UI renders correctly, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. Build passes: `npm run build` completes without errors
2. No mock data: progress/page.tsx fetches from prisma.milestone
3. Shared utilities: dashboard/page.tsx imports calculateOverallProgress
4. Type safety: All files use Milestone type from lib/types/milestone
5. Empty state handled: Progress page doesn't crash with 0 milestones
</verification>

<success_criteria>
- Progress page fetches real milestone data from database
- Dashboard uses shared calculateOverallProgress utility
- MilestoneChecklist component renders milestone list with proper styling
- Active milestone is visually highlighted
- Empty state renders gracefully when no milestones exist
- No TypeScript or build errors
- Human verification confirms UI renders correctly
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-progress-tracking/02-03-SUMMARY.md`
</output>
