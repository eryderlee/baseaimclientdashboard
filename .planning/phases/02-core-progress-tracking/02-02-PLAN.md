---
phase: 02-core-progress-tracking
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - lib/milestone-utils.ts
  - components/dashboard/milestone-status-badge.tsx
  - components/dashboard/milestone-item.tsx
  - components/dashboard/milestone-notes.tsx
  - components/dashboard/milestone-checklist.tsx
autonomous: true

must_haves:
  truths:
    - "Status icons use color-blind-safe colors with text labels (not color-only)"
    - "Active milestone is visually highlighted with distinct border/ring treatment"
    - "Due dates display as 'Week of Jan 15' format (week-level precision)"
    - "Completed milestones show completion date"
    - "Progress notes render as mini-changelog below each milestone"
  artifacts:
    - path: "lib/milestone-utils.ts"
      provides: "Utility functions for milestone calculations and formatting"
      exports: ["calculateOverallProgress", "getActiveMilestone", "formatWeekLevel"]
    - path: "components/dashboard/milestone-status-badge.tsx"
      provides: "Status badge component with color-coded indicator and text"
      exports: ["MilestoneStatusBadge"]
    - path: "components/dashboard/milestone-item.tsx"
      provides: "Individual milestone row with status, description, dates, progress"
      exports: ["MilestoneItem"]
    - path: "components/dashboard/milestone-notes.tsx"
      provides: "Notes display component for progress changelog entries"
      exports: ["MilestoneNotes"]
    - path: "components/dashboard/milestone-checklist.tsx"
      provides: "Full checklist component with overall progress and milestone list"
      exports: ["MilestoneChecklist"]
  key_links:
    - from: "components/dashboard/milestone-item.tsx"
      to: "lib/types/milestone.ts"
      via: "imports Milestone type"
      pattern: "import.*Milestone.*from.*lib/types/milestone"
    - from: "components/dashboard/milestone-checklist.tsx"
      to: "lib/milestone-utils.ts"
      via: "uses calculateOverallProgress and getActiveMilestone"
      pattern: "calculateOverallProgress|getActiveMilestone"
---

<objective>
Build reusable milestone UI components with proper accessibility and visual hierarchy

Purpose: Create the visual components for progress tracking (PROG-01, PROG-02, PROG-04, PROG-05, PROG-06, PROG-07, PROG-09). Components handle status display, active highlighting, date formatting, and notes rendering.

Output: Utility functions for milestone logic, and 4 React components for milestone display.
</objective>

<execution_context>
@C:\Users\eryde\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\eryde\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-progress-tracking/02-RESEARCH.md
@.planning/phases/02-core-progress-tracking/02-01-SUMMARY.md
@lib/types/milestone.ts
@components/ui/progress.tsx
@components/ui/card.tsx
@components/ui/badge.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create milestone utility functions</name>
  <files>lib/milestone-utils.ts</files>
  <action>
Create `lib/milestone-utils.ts` with utility functions for milestone logic:

1. `calculateOverallProgress(milestones: Milestone[]): number`
   - Return percentage of completed milestones (not average of progress values)
   - Formula: (completedCount / totalCount) * 100
   - Return 0 if milestones array is empty
   - Round to nearest integer

2. `getActiveMilestone(milestones: Milestone[]): Milestone | null`
   - Return the first milestone with status IN_PROGRESS
   - If none IN_PROGRESS, return first NOT_STARTED milestone
   - If all complete or blocked, return null

3. `formatWeekLevel(date: Date | string | null): string`
   - Format date as "Week of Jan 15, 2026" (week-level precision per PROG-06)
   - Use native Intl.DateTimeFormat for locale-safe formatting
   - Handle null dates by returning empty string
   - Accept both Date objects and ISO strings

4. `getStatusConfig(status: MilestoneStatus)`: object
   - Return { icon, color, bgColor, borderColor, label } for each status
   - Colors should be color-blind-safe (blue for in-progress, emerald for complete, slate for not-started, red for blocked)
   - Include text label for accessibility

Import Milestone and MilestoneStatus types from lib/types/milestone.ts.
  </action>
  <verify>
Run `npx tsc --noEmit lib/milestone-utils.ts` to verify compilation. Manually verify formatWeekLevel produces correct output format.
  </verify>
  <done>Utility functions exist for progress calculation, active milestone detection, and week-level date formatting</done>
</task>

<task type="auto">
  <name>Task 2: Create status badge and milestone item components</name>
  <files>components/dashboard/milestone-status-badge.tsx, components/dashboard/milestone-item.tsx, components/dashboard/milestone-notes.tsx</files>
  <action>
Create three components:

**1. MilestoneStatusBadge** (`components/dashboard/milestone-status-badge.tsx`):
- Props: { status: MilestoneStatus }
- Render pill-shaped badge with icon + text label
- Use getStatusConfig() for colors
- Include aria-label for screen readers
- Color combinations: emerald (completed), blue (in-progress), slate (not-started), red (blocked)

**2. MilestoneItem** (`components/dashboard/milestone-item.tsx`):
- Props: { milestone: Milestone, isActive: boolean, isLast: boolean }
- Structure:
  - Left: Status icon with connector line to next milestone (unless isLast)
  - Right: Title, description, status badge, progress bar, dates, notes
- Active milestone: Add ring-2 ring-primary rounded-lg p-4 styling for visual highlight (PROG-04)
- Show "Due: Week of..." for dueDate (PROG-06)
- Show "Completed Week of..." for completedAt if status is COMPLETED (PROG-07)
- Use Progress component from ui/progress.tsx for progress bar
- Use Lucide icons: CheckCircle2 (completed), Clock (in-progress), Circle (not-started), AlertCircle (blocked)
- Include aria-labels on icons for accessibility

**3. MilestoneNotes** (`components/dashboard/milestone-notes.tsx`):
- Props: { notes: MilestoneNote[] }
- Render list of mini-changelog entries (PROG-09)
- Each note shows: content text, createdAt formatted as relative time or date, createdBy
- If notes empty, render nothing (not "no notes" placeholder)
- Style as subtle secondary text below milestone content
  </action>
  <verify>
Run `npx tsc --noEmit` on all three component files. Verify imports resolve correctly.
  </verify>
  <done>MilestoneStatusBadge, MilestoneItem, and MilestoneNotes components created with proper accessibility attributes and visual hierarchy</done>
</task>

<task type="auto">
  <name>Task 3: Create MilestoneChecklist container component</name>
  <files>components/dashboard/milestone-checklist.tsx</files>
  <action>
Create `components/dashboard/milestone-checklist.tsx` as the main container component:

Props: { milestones: Milestone[] }

Structure:
1. Overall Progress Card (top):
   - CardTitle: "Overall Progress"
   - CardDescription: "X of Y milestones completed"
   - Large progress bar (h-4) showing overall percentage
   - Large percentage text (text-3xl font-bold)
   - Use role="status" aria-live="polite" for screen reader announcements

2. Milestones Timeline Card (below):
   - CardTitle: "Project Milestones"
   - CardDescription: "Track your project progress step by step"
   - Empty state: Calendar icon + "No milestones yet. Your project manager will set them up soon."
   - Non-empty: Map over milestones rendering MilestoneItem for each
     - Pass isActive={milestone.id === activeMilestone?.id}
     - Pass isLast={index === milestones.length - 1}

Use utility functions:
- calculateOverallProgress(milestones) for percentage
- getActiveMilestone(milestones) to identify which milestone to highlight

Import Card, CardHeader, CardTitle, CardDescription, CardContent from ui/card.tsx.
Import Progress from ui/progress.tsx.
Import MilestoneItem from ./milestone-item.tsx.
  </action>
  <verify>
Run `npx tsc --noEmit components/dashboard/milestone-checklist.tsx`. Verify all imports resolve and component compiles.
  </verify>
  <done>MilestoneChecklist component renders overall progress summary and list of milestone items with active highlighting</done>
</task>

</tasks>

<verification>
1. All files compile: `npx tsc --noEmit` passes for all new files
2. Imports resolve: No "module not found" errors
3. Accessibility: Status icons have aria-labels, progress has role="status"
4. Color-blind safety: Status indicators use icons + text labels, not color alone
5. Date formatting: formatWeekLevel produces "Week of Month DD, YYYY" format
</verification>

<success_criteria>
- 4 utility functions created in lib/milestone-utils.ts
- 4 React components created for milestone display
- Active milestone receives distinct visual treatment (ring highlight)
- Status indicators are accessible (icons + text + aria-labels)
- Dates formatted at week-level precision
- Notes display as mini-changelog entries
- All files compile without TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-progress-tracking/02-02-SUMMARY.md`
</output>
